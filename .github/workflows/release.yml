build-desktop:
  needs: create-release
  permissions:
    contents: write
  strategy:
    fail-fast: false
    matrix:
      platform: [macos-latest, windows-latest]  # Только macOS и Windows
  runs-on: ${{ matrix.platform }}
  env:
    CYPRESS_INSTALL_BINARY: 0
  steps:
    - name: Checkout qspider 🛎️
      uses: actions/checkout@v4
      with:
        repository: 'QSPFoundation/qspider'
        ref: 'release'
    - name: Checkout game 🛎️
      uses: actions/checkout@v4
      with:
        path: 'public/game'
    - name: Use Node.js 20
      uses: actions/setup-node@v4
      with:
        node-version: 20
        cache: 'npm'
    - name: Rust setup
      uses: dtolnay/rust-toolchain@stable
    - name: Rust cache
      uses: swatinem/rust-cache@v2
      with:
        workspaces: './src-tauri -> target'
    - run: npm ci
    - run: npm run tauri icon public/game/game-icon.png
    - uses: tauri-apps/tauri-action@v0
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        TAURI_PRIVATE_KEY: ${{ secrets.TAURI_PRIVATE_KEY }}
        TAURI_KEY_PASSWORD: ${{ secrets.TAURI_KEY_PASSWORD }}
      with:
        releaseId: ${{ needs.create-release.outputs.release_id }}
        args: -c public/game/game.build.conf.json
